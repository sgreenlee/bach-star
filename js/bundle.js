(()=>{var e={743:(e,t,n)=>{var o,s,a,i=n(104),r=i.KEY_MAPS,l=(i.KEY_NOTE_MAP,n(249)),c=n(786),d=!0,u=$("#note-container"),p=new c;function m(e){var t=NoteRolls.roll;t.isLoaded()?(a=new c,t.notes.forEach((function(e){a.add(new l(e.note,e.time))})),p.forEach(h),Sounds.music.play(),d=!1,s=performance.now(),o=setInterval((function(){var e=performance.now()-s;a.while((function(t){return t.item.time-e<7500}),(function(e){p.add(e.item),e.item.generateDOMElement(),u.append(e.item.element),e.delete()}))}),100),_()):setTimeout(m.bind(this,e),20)}function h(e){e.delete(),e.item.element.fadeOut(400,(function(){$(this).remove()}))}function f(e){var t=e.item,n=arguments[1],o=Math.floor(t.time-n);t.y=o+400,t.y<300?(t.element.addClass("missed"),h(e),StarMeter.malus(6),Sounds.mistakes[Math.floor(Math.random()*Sounds.mistakes.length)].play()):t.element.css("bottom",t.y)}function _(){if(!d){var e=performance.now()-s;p.forEach(f,e),requestAnimationFrame(_)}}function v(e,t){var n=e.item;n.name===t&&(StarMeter.bonus(n.y-400),n.element.addClass("scored"),h(e))}function b(){console.log("stopping"),d=!0,clearInterval(o)}new c,window.stop=b,document.addEventListener("keydown",(function(e){var t=r[e.keyCode];$("."+t).addClass("pressed"),function(e){p.while((function(e){return e.item.y<500}),v,e)}(t)})),document.addEventListener("keyup",(function(e){var t=r[e.keyCode];$("."+t).removeClass("pressed")})),e.exports={load:function(){m("bach_minuet_g_major")},stop:b}},104:e=>{e.exports={KEY_MAPS:{65:"B1",83:"C1",68:"D1",70:"E1",71:"F1",72:"G1",74:"A1",75:"B2",76:"C2",186:"D2"},NOTE_NAMES:["G1","A1","B1","C1","D1","E2","F2","G2","A2","B2"],KEY_NOTE_MAP:{65:"G4",83:"A4",68:"B4",70:"C5",71:"D5",72:"E5",74:"F5",75:"G5",76:"A5",186:"B5"}}},786:e=>{function t(e,t,n){this.item=e,this.prev=t||null,this.next=n||null}function n(){this._head=new t(null),this._tail=new t(null),this._tail.prev=this._head,this._head.next=this._tail}t.prototype.delete=function(){this.prev.next=this.next,this.next.prev=this.prev},n.prototype.add=function(e){var n=new t(e);n.prev=this._tail.prev,n.next=this._tail,this._tail.prev.next=n,this._tail.prev=n},n.prototype.forEach=function(e){for(var t=[].slice.call(arguments,1),n=this._head.next;null!==n.next;)e.apply(null,[n].concat(t)),n=n.next},n.prototype.while=function(e,t){for(var n=[].slice.call(arguments,2),o=this._head.next;null!==o.next&&e(o);)t.apply(null,[o].concat(n)),o=o.next},e.exports=n},419:e=>{var t=$("#modal-overlay"),n=$(".modal.lose"),o=$(".modal.win"),s=$(".modal.load"),a=$(".modal.select"),i=$("body"),r=function(){},l=document.querySelectorAll(".new-game"),c=document.querySelectorAll(".song-select");function d(){m.close(),v.open()}function u(e){var t=e.target.attributes["data-song"].value;r(t)}for(var p=0;p<l.length;p++)l[p].addEventListener("click",d);for(p=0;p<c.length;p++)c[p].addEventListener("click",u);t.detach(),t.css("display","block"),n.detach(),n.css("top","50%"),o.detach(),o.css("top","50%"),s.detach(),s.css("top","50%"),a.detach(),a.css("top","50%");var m=null,h={open:function(){i.append(t),i.append(n),m=this},close:function(){t.detach(),n.detach()}},f={open:function(){i.append(t),i.append(o),m=this},close:function(){t.detach(),o.detach()}},_={open:function(){i.append(t),i.append(s),m=this},close:function(){t.detach(),s.detach()}},v={open:function(){i.append(t),i.append(a),m=this},close:function(){t.detach(),a.detach()}};e.exports={setRestartCallback:function(e){r=e},lose:h,win:f,load:_,select:v,close:function(){m.close()}}},249:(e,t,n)=>{var o=n(104).NOTE_NAMES,s=o.length;function a(e,t){this.name=e,this.time=t}a.prototype.generateDOMElement=function(){this.element=$("<div>").addClass("note").addClass(this.name)},a.random=function(){return new a(o[Math.floor(Math.random()*s)])},e.exports=a},950:e=>{function t(e){var t=this;this.req=new XMLHttpRequest,this.req.open("GET",e),this.req.addEventListener("load",(function(e){t.notes=JSON.parse(this.responseText).track})),this.req.send()}t.prototype.isLoaded=function(){return 4===this.req.readyState};var n={bach_minuet_g_major:new t("assets/json/bach_minuet_g_major.json"),bach_invention4_d_minor:new t("assets/json/bach_invention4_d_minor.json"),bach_goldberg_aria:new t("assets/json/bach_goldberg_aria.json")};noteRolls={roll:n.bach_minuet_g_major,setSong:function(e){this.roll=n[e]}},e.exports=noteRolls},581:e=>{var t=new(window.AudioContext||window.webkitAudioContext),n=function(){};function o(){n()}function s(e){this._mediaElement=new Audio(e);var n=this;this._mediaElement.onload=function(){n._sourceNode=t.createMediaElementSource(this._mediaElement),n._gainNode.connect(t.destination)}}function a(e){this._mediaElement=new Audio(e);var n=this;this._mediaElement.onload=function(){n._sourceNode=t.createMediaElementSource(this._mediaElement),n._gainNode.connect(t.destination)}}s.prototype.play=function(){this._mediaElement.play()},s.prototype.stop=function(){this._mediaElement.pause(),this._mediaElement.currentTime=0},s.prototype.setVolume=function(e){this._mediaElement.volume=e},s.prototype.setLoop=function(e){this._mediaElement.loop=e},s.prototype.isLoaded=function(){return 4===this._mediaElement.readyState},s.prototype.addEventListener=function(){var e=[].slice.call(arguments);this._mediaElement.addEventListener.apply(this._mediaElement,e)},a.prototype=Object.create(s.prototype);var i=new s("https://sgreenlee.github.io/bach-star/assets/mp3/boo.mp3"),r=new s("https://sgreenlee.github.io/bach-star/assets/mp3/applause.mp3"),l=new s("https://sgreenlee.github.io/bach-star/assets/mp3/mistake1.mp3"),c=new s("https://sgreenlee.github.io/bach-star/assets/mp3/mistake2.mp3"),d={bach_minuet_g_major:new a("https://sgreenlee.github.io/bach-star/assets/mp3/bach_minuet_g_major.mp3"),bach_invention4_d_minor:new a("https://sgreenlee.github.io/bach-star/assets/mp3/bach_invention4_dminor.mp3"),bach_goldberg_aria:new a("https://sgreenlee.github.io/bach-star/assets/mp3/bach_goldberg_aria.mp3")},u={music:d.bach_minuet_g_major,boo:i,applause:r,mistakes:[l,c],setMusicEndCallback:function(e){n=e},allLoaded:function(){return this.music.isLoaded()&&this.boo.isLoaded()&&this.applause.isLoaded()},setSong:function(e){this.music=d[e],this.music.addEventListener("ended",o)}};e.exports=u},957:e=>{$("#star-meter");var t=$("#star-meter-hp"),n=80,o=function(){};function s(){var e,o;t.css("height",n+"%"),t.css("background-color",(e=Math.floor(n/100*195+22),"rgb("+Math.floor(239-e)+", "+e+", 41)")),o=(o=n<=80?(80-n)/60:0)>=1?1:o,Sounds.boo.setVolume(o)}var a={reset:function(){n=80,s()},bonus:function(e){var t=(100-Math.abs(e))/10;(n+=t)>100&&(n=100),s()},malus:function(e){n-=e,s(),this.isLost()&&o()},isLost:function(){return n<20},setLoseCallback:function(e){o=e}};s(),e.exports=a}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}(()=>{var e=n(104);function t(){Game.stop(),Sounds.applause.play(),Modals.win.open()}e.KEY_MAPS,e.KEY_NOTE_MAP,window.Game=n(743),window.Sounds=n(581),window.StarMeter=n(957),window.NoteRolls=n(950),window.Modals=n(419);var o=!1,s=new Image;s.onload=function(){document.body.style.backgroundImage="url(https://s3.amazonaws.com/hhero-pro/bg.png)",o=!0},s.src="https://s3.amazonaws.com/hhero-pro/bg.png",StarMeter.setLoseCallback((function(){Game.stop(),Sounds.music.stop(),Sounds.boo.setLoop(!1),Modals.lose.open()})),Modals.setRestartCallback((function(e){Modals.close(),Sounds.setSong(e),Sounds.setMusicEndCallback(t),NoteRolls.setSong(e),Sounds.boo.play(),Sounds.boo.setLoop(!0),Sounds.boo.setVolume(0),StarMeter.reset(),Game.load()})),document.addEventListener("DOMContentLoaded",(function(){!function e(){if(o&&Sounds.allLoaded()){var t=document.getElementById("loading-screen");document.body.removeChild(t),Modals.load.open()}else setTimeout((function(){e()}),20)}()}))})()})();